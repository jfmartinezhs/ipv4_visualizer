<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Visualizador IPv4 - Archivo Único</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500;700&display=swap');
      body { font-family: 'Inter', sans-serif; }
      .font-mono { font-family: 'Fira Code', monospace; }
    </style>

    <!-- React & ReactDOM (UMD) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel Standalone (to compile JSX in browser) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-slate-50 text-slate-900 antialiased">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ICONS (Inline SVGs to avoid external dependencies issues in single file) ---
        const IconGlobe = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></svg>
        );
        const IconCpu = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="4" y="4" width="16" height="16" rx="2"/><rect x="9" y="9" width="6" height="6"/><path d="M15 2v2"/><path d="M15 20v2"/><path d="M2 15h2"/><path d="M2 9h2"/><path d="M20 15h2"/><path d="M20 9h2"/><path d="M9 2v2"/><path d="M9 20v2"/></svg>
        );
        const IconNetwork = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="16" y="16" width="6" height="6" rx="1"/><rect x="2" y="16" width="6" height="6" rx="1"/><rect x="9" y="2" width="6" height="6" rx="1"/><path d="M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3"/><path d="M12 12V8"/></svg>
        );
        const IconHash = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="4" y1="9" x2="20" y2="9"/><line x1="4" y1="15" x2="20" y2="15"/><line x1="10" y1="3" x2="8" y2="21"/><line x1="16" y1="3" x2="14" y2="21"/></svg>
        );
        const IconRefreshCw = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
        );
        const IconInfo = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
        );
        const IconLayers = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"/><path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"/><path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"/></svg>
        );


        // --- UTILS ---
        const ipToBinaryArray = (ip) => {
            const parts = ip.split('.').map(Number);
            if (parts.length !== 4 || parts.some(isNaN)) return new Array(32).fill(0);
            
            const binaryString = parts
                .map((part) => part.toString(2).padStart(8, '0'))
                .join('');
                
            return binaryString.split('').map(Number);
        };

        const binaryToIp = (binary) => {
            const octets = [];
            for (let i = 0; i < 32; i += 8) {
                const octetBinary = binary.slice(i, i + 8).join('');
                octets.push(parseInt(octetBinary, 2).toString());
            }
            return octets.join('.');
        };

        const calculateNetworkAddress = (ip, cidr) => {
            const binary = ipToBinaryArray(ip);
            const networkBinary = binary.map((bit, index) => (index < cidr ? bit : 0));
            return binaryToIp(networkBinary);
        };

        const calculateBroadcastAddress = (ip, cidr) => {
            const binary = ipToBinaryArray(ip);
            const broadcastBinary = binary.map((bit, index) => (index < cidr ? bit : 1));
            return binaryToIp(broadcastBinary);
        };

        const calculateSubnetMask = (cidr) => {
            const maskBinary = new Array(32).fill(0).map((_, i) => (i < cidr ? 1 : 0));
            return binaryToIp(maskBinary);
        };

        const isValidIp = (ip) => {
            const parts = ip.split('.');
            if (parts.length !== 4) return false;
            return parts.every((part) => {
                const num = parseInt(part, 10);
                return !isNaN(num) && num >= 0 && num <= 255 && part === num.toString();
            });
        };

        const formatNumberWithCommas = (x) => {
            return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        };

        const getRandomIp = () => {
            return Array.from({ length: 4 }, () => Math.floor(Math.random() * 256)).join('.');
        };

        // --- COMPONENTS ---

        const BitVisualizer = ({ ip, cidr }) => {
            const bits = ipToBinaryArray(ip);
            const octets = ip.split('.').map(Number);

            const bitChunks = [];
            for (let i = 0; i < 32; i += 8) {
                bitChunks.push(bits.slice(i, i + 8));
            }

            return (
                <div className="w-full space-y-8">
                    {/* 
                      Responsive Grid:
                      Mobile: 1 col, Tablet: 2 cols, Desktop: 4 cols
                    */}
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-y-8 gap-x-2 justify-items-center w-full">
                        {bitChunks.map((chunk, octetIndex) => {
                        const octetValue = octets[octetIndex] !== undefined ? octets[octetIndex] : 0;
                        
                        return (
                            <div key={octetIndex} className="flex flex-col items-center">
                            
                            {/* Binary Representation */}
                            <div className="flex gap-[1px] sm:gap-[2px]">
                                {chunk.map((bit, bitIndex) => {
                                const globalIndex = octetIndex * 8 + bitIndex;
                                const isNetwork = globalIndex < cidr;
                                
                                return (
                                    <div
                                    key={bitIndex}
                                    className={`
                                        flex items-center justify-center flex-shrink-0
                                        font-bold font-mono rounded-sm transition-colors duration-300 select-none
                                        
                                        /* Responsive Sizing Logic (Updated to fix clipping) */
                                        w-7 h-9 text-sm             /* Mobile: Medium */
                                        sm:w-8 sm:h-10 sm:text-base /* Tablet: Large */
                                        lg:w-6 lg:h-8 lg:text-xs    /* Laptop (4 cols): Small */
                                        xl:w-8 xl:h-10 xl:text-sm   /* Large Desktop: Large */

                                        ${isNetwork 
                                        ? 'bg-blue-200 text-blue-900 border-b-2 sm:border-b-4 border-blue-400' 
                                        : 'bg-green-200 text-green-900 border-b-2 sm:border-b-4 border-green-400'}
                                    `}
                                    title={`Bit ${globalIndex + 1}: ${isNetwork ? 'Red' : 'Host'}`}
                                    >
                                    {bit}
                                    </div>
                                );
                                })}
                            </div>

                            {/* Powers of 2 (Guide) */}
                            <div className="flex gap-[1px] sm:gap-[2px] mt-1 opacity-50">
                                {chunk.map((_, bitIndex) => (
                                    <div 
                                      key={bitIndex} 
                                      className={`
                                        text-center font-mono text-slate-500
                                        w-7 text-[10px]             /* Mobile */
                                        sm:w-8 sm:text-[10px]       /* Tablet */
                                        lg:w-6 lg:text-[9px]        /* Laptop */
                                        xl:w-8 xl:text-[10px]       /* Desktop */
                                      `}
                                    >
                                      {Math.pow(2, 7 - bitIndex)}
                                    </div>
                                ))}
                            </div>

                            {/* Decimal Value */}
                            <div className="font-mono text-xl font-bold text-slate-700 mt-2 bg-slate-100 px-3 py-1 rounded-md min-w-[3rem] text-center">
                                {isNaN(octetValue) ? 0 : octetValue}
                            </div>
                            </div>
                        );
                        })}
                    </div>

                    <div className="flex flex-wrap justify-center gap-6 mt-6 border-t border-slate-100 pt-6">
                        <div className="flex items-center gap-2">
                            <div className="w-4 h-4 bg-blue-200 border border-blue-400 rounded"></div>
                            <span className="text-sm font-medium text-slate-600">Porción de Red ({cidr} bits)</span>
                        </div>
                        <div className="flex items-center gap-2">
                            <div className="w-4 h-4 bg-green-200 border border-green-400 rounded"></div>
                            <span className="text-sm font-medium text-slate-600">Porción de Host ({32 - cidr} bits)</span>
                        </div>
                    </div>
                </div>
            );
        };

        const InfoCard = ({ label, value, subValue, icon: Icon, colorClass }) => {
            return (
                <div className={`p-4 rounded-xl border ${colorClass} bg-white shadow-sm transition-all hover:shadow-md`}>
                <div className="flex items-start justify-between mb-2">
                    <span className="text-sm font-medium text-slate-500 uppercase tracking-wider">{label}</span>
                    <div className={`p-2 rounded-lg opacity-20 ${colorClass.replace('border', 'bg')}`}>
                        <Icon size={20} className="text-current" />
                    </div>
                </div>
                <div className="font-mono text-xl md:text-2xl font-bold text-slate-800 break-all">
                    {value}
                </div>
                {subValue && (
                    <div className="mt-1 text-xs text-slate-400 font-medium">
                    {subValue}
                    </div>
                )}
                </div>
            );
        };

        // --- APP ---

        const App = () => {
            const [ipAddress, setIpAddress] = useState('192.168.1.10');
            const [cidr, setCidr] = useState(24);
            const [error, setError] = useState('');

            // Derived state
            const subnetMask = calculateSubnetMask(cidr);
            const networkAddress = isValidIp(ipAddress) ? calculateNetworkAddress(ipAddress, cidr) : '---';
            const broadcastAddress = isValidIp(ipAddress) ? calculateBroadcastAddress(ipAddress, cidr) : '---';
            
            // Calculate hosts
            const totalHosts = Math.pow(2, 32 - cidr);
            const usableHosts = totalHosts > 2 ? totalHosts - 2 : 0;

            const handleIpChange = (e) => {
                const val = e.target.value;
                setIpAddress(val);
                if (!isValidIp(val) && val !== '') {
                setError('Formato de IP inválido (ej: 192.168.1.1)');
                } else {
                setError('');
                }
            };

            const generateRandom = () => {
                setIpAddress(getRandomIp());
                setCidr(Math.floor(Math.random() * 24) + 8);
                setError('');
            };

            return (
                <div className="min-h-screen bg-slate-50 py-8 px-4 sm:px-6 lg:px-8 font-sans">
                <div className="max-w-5xl mx-auto space-y-8">
                    
                    {/* Header */}
                    <div className="text-center space-y-2">
                    <div className="inline-flex items-center justify-center p-3 bg-indigo-100 rounded-full mb-4">
                        <IconGlobe className="w-8 h-8 text-indigo-600" />
                    </div>
                    <h1 className="text-3xl md:text-4xl font-bold text-slate-900">
                        Calculadora y Visualizador IPv4
                    </h1>
                    <p className="text-lg text-slate-600 max-w-2xl mx-auto">
                        Explora interactivamente cómo la máscara de subred divide una dirección IP en porciones de Red y de Host.
                    </p>
                    </div>

                    {/* Controls Section */}
                    <div className="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 md:p-8">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
                            
                            {/* IP Input */}
                            <div className="space-y-3">
                                <label htmlFor="ip-input" className="block text-sm font-semibold text-slate-700">
                                    Dirección IPv4
                                </label>
                                <div className="relative">
                                    <input
                                        id="ip-input"
                                        type="text"
                                        value={ipAddress}
                                        onChange={handleIpChange}
                                        placeholder="Ej: 192.168.0.1"
                                        className={`w-full pl-4 pr-12 py-3 bg-slate-50 border ${error ? 'border-red-300 focus:ring-red-200' : 'border-slate-300 focus:ring-indigo-200'} rounded-xl focus:outline-none focus:ring-4 transition-all font-mono text-lg`}
                                    />
                                    <button 
                                        onClick={generateRandom}
                                        className="absolute right-2 top-2 p-1.5 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors"
                                        title="Generar IP Aleatoria"
                                    >
                                        <IconRefreshCw size={20} />
                                    </button>
                                </div>
                                {error && <p className="text-red-500 text-sm mt-1">{error}</p>}
                            </div>

                            {/* CIDR Slider */}
                            <div className="space-y-4">
                                <div className="flex justify-between items-center">
                                    <label htmlFor="cidr-slider" className="block text-sm font-semibold text-slate-700">
                                        Prefijo CIDR (Máscara)
                                    </label>
                                    <span className="inline-block px-3 py-1 bg-indigo-100 text-indigo-700 text-sm font-bold rounded-full font-mono">
                                        /{cidr}
                                    </span>
                                </div>
                                <input
                                    id="cidr-slider"
                                    type="range"
                                    min="0"
                                    max="32"
                                    value={cidr}
                                    onChange={(e) => setCidr(parseInt(e.target.value))}
                                    className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600"
                                />
                                <div className="flex justify-between text-xs text-slate-400 font-mono">
                                    <span>/0</span>
                                    <span>/8</span>
                                    <span>/16</span>
                                    <span>/24</span>
                                    <span>/32</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Visualization Area */}
                    {isValidIp(ipAddress) ? (
                        <div className="bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden">
                            <div className="bg-slate-50 px-6 py-4 border-b border-slate-200 flex items-center justify-between">
                                <h3 className="font-semibold text-slate-700 flex items-center gap-2">
                                    <IconCpu className="w-5 h-5 text-slate-400" />
                                    Visualización de Bits
                                </h3>
                                <div className="text-sm font-mono text-slate-500">
                                    {ipAddress} / {cidr}
                                </div>
                            </div>
                            
                            <div className="p-6 md:p-8">
                                <BitVisualizer ip={ipAddress} cidr={cidr} />
                            </div>
                        </div>
                    ) : (
                        <div className="bg-amber-50 rounded-xl p-8 text-center border border-amber-200 text-amber-800">
                            <IconInfo className="w-12 h-12 mx-auto mb-3 opacity-50" />
                            <p>Ingresa una dirección IP válida para ver la visualización.</p>
                        </div>
                    )}

                    {/* Info Grid */}
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                        <InfoCard 
                            label="Máscara de Red"
                            value={subnetMask}
                            subValue={`Binario: ${'1'.repeat(cidr)}${'0'.repeat(32-cidr)}`}
                            icon={IconLayers}
                            colorClass="border-slate-200"
                        />
                        <InfoCard 
                            label="Dirección de Red"
                            value={networkAddress}
                            subValue={`Primer IP del bloque`}
                            icon={IconNetwork}
                            colorClass="border-blue-200"
                        />
                        <InfoCard 
                            label="Broadcast"
                            value={broadcastAddress}
                            subValue="Última IP del bloque"
                            icon={IconGlobe}
                            colorClass="border-purple-200"
                        />
                        <InfoCard 
                            label="Hosts Utilizables"
                            value={formatNumberWithCommas(usableHosts)}
                            subValue={`Total: ${formatNumberWithCommas(totalHosts)}`}
                            icon={IconHash}
                            colorClass="border-green-200"
                        />
                    </div>

                    {/* Legend / Explanation */}
                    <div className="bg-slate-100 rounded-xl p-6 text-sm text-slate-600 space-y-2">
                        <h4 className="font-bold text-slate-800 mb-2">¿Cómo funciona?</h4>
                        <ul className="list-disc list-inside space-y-1 ml-2">
                            <li>
                                La <span className="font-bold text-blue-700">Porción de Red</span> (azul) identifica a qué subred pertenece el dispositivo. Está determinada por los primeros <strong>{cidr}</strong> bits.
                            </li>
                            <li>
                                La <span className="font-bold text-green-700">Porción de Host</span> (verde) identifica al dispositivo específico dentro de esa red. Son los bits restantes (<strong>{32 - cidr}</strong>).
                            </li>
                            <li>
                                Cambia el deslizador "Prefijo CIDR" para mover la "línea divisoria" entre la red y el host.
                            </li>
                        </ul>
                    </div>
                </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>